/****** Object:  UserDefinedFunction [dbo].[fn_AssignRange]    Script Date: 04/18/2015 12:54:45 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

--DECLARE @rangestring varchar(500) = ('30,45:49,33,00:11,60') 
--DECLARE @value varchar(50) = '47'

CREATE FUNCTION [dbo].[fn_AssignRange](@rangestring varchar(50),@value varchar(50))
RETURNS int
AS
BEGIN
DECLARE @included int
DECLARE csr_compare CURSOR
FOR
SELECT LowRange,HighRange FROM
(
SELECT LEFT(Item,CHARINDEX(':',Item)-1) as LowRange,SUBSTRING(Item,CHARINDEX(':',Item)+1,50) as HighRange FROM (SELECT * FROM dbo.SplitParameters(@rangestring,',')) a WHERE CHARINDEX(':',Item)> 0 
UNION ALL
SELECT Item as LowRange, Item as HighRange FROM (SELECT * FROM dbo.SplitParameters(@rangestring,',')) a WHERE CHARINDEX(':',Item)=0
) a

DECLARE @LowRange varchar(50), @HighRange varchar(50)
OPEN csr_compare
WHILE @@CURSOR_ROWS > 0 
	BEGIN
		FETCH NEXT FROM csr_compare INTO @LowRange,@HighRange
		IF @@FETCH_STATUS <> 0 --No more records
			BEGIN
				BREAK
			END
		IF @value >= @LowRange AND @value <= @HighRange
			BEGIN
				SET @included = 1
				BREAK
			END
		ELSE
			SET @included = 0
	END

CLOSE csr_compare
DEALLOCATE csr_compare

RETURN @included
END
--PRINT @included
--PRINT @value
--PRINT @LowRange
--PRINT @HighRange
GO


