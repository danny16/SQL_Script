SELECT
CURNCYID
,EXCHDATE
,YEAR(EXCHDATE)*100+MONTH(EXCHDATE) as Period
,XCHGRATE
FROM MC00100 
WHERE CURNCYID in ('MXP')
AND EXCHDATE in (
SELECT
TimePeriod
FROM
(
SELECT ROW_NUMBER() OVER(PARTITION BY (YEAR(TimePeriod)*100+MONTH(TimePeriod)) ORDER BY TimePeriod) AS RowNum, MONTH(t.TimePeriod) as Month, t.TimePeriod
FROM
(SELECT EXCHDATE as TimePeriod
FROM MC00100 x
WHERE YEAR(EXCHDATE)*100+MONTH(EXCHDATE) BETWEEN  201501 AND 201512
AND CURNCYID in ('MXP')
) t
) t1 WHERE t1.RowNum = 1
)
ORDER BY 2
